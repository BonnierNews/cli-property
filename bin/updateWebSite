#!/usr/bin/env node

let WebSite = require('../src/website');


function main()
{

    let args = process.argv.slice(2);
    let env = args[0];
    let akamaienv = args[1];
    let website = new WebSite.WebSite();

    let devProperty = "dev-www.akamaiedgedemo.com";
    let qaProperty = "qa-www.akamaiedgedemo.com";
    let prodProperty = "www.akamaiedgedemo.com";

    let targetProperty = env; //dev
    if (env == "qa")
        targetProperty = qaProperty;
    else if (env == "www")
        targetProperty = prodProperty;

    let newVersion;
    if (devProperty != targetProperty)
        website.copySite(devProperty, null, targetProperty)
            .then(data => {
                newVersion = data.propertyVersion;
                return website.activateSite(targetProperty, newVersion, WebSite.STAGING, "Updated Automatically to STAGING!", ["colinb@akamai.com"]);
            })
            .then(data => {
                return website.activateSite(targetProperty, newVersion, WebSite.PRODUCTION, "Updated Automatically to PRODUCTION!", ["colinb@akamai.com"]);
            })
        .catch((error) => {
            console.error("ERROR: ", error);
        });
}

main();
