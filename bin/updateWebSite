#!/usr/bin/env node
"use strict";

//import {WebSite, AKAMAI_ENV} from '../src/website';
let website = require('../src/website');

function main()
{
    let args = process.argv.slice(2);
    let env = args[0];
    let website = new website.WebSite();

    let devProperty = "dev-www.akamaiedgedemo.com";
    let qaProperty = "qa-www.akamaiedgedemo.com";
    let prodProperty = "www.akamaiedgedemo.com";

    let targetProperty = env; //dev
    if (env == "qa")
        targetProperty = qaProperty;
    else if (env == "www")
        targetProperty = prodProperty;

    let newVersion;
    if (devProperty != targetProperty)
        website.copy(devProperty, null, targetProperty)
        .then(data => {
            newVersion = data.propertyVersion;
            return website.activate(targetProperty, newVersion, WebSite.AKAMAI_ENV.STAGING, "Updated Automatically to STAGING!", ["colinb@akamai.com"]);
        })
        .then(success => {
            return website.promoteStagingToProd(targetProperty, "Updated Automatically to PRODUCTION!", ["colinb@akamai.com"]);
        })
        .then(() => {console.info("Successfully Active!")})
        .catch((error) => {
            console.error("ERROR: ", error);
        });
}

main();
